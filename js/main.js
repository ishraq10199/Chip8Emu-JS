import { getCPUInstance } from "./core/cpu.js";
import { getDisplayInstance } from "./core/display.js";
import { getGlobalInstance } from "./core/global.js";

import { registerDOMEvents } from "./core/init.js";
import { getInputInstance } from "./core/input.js";
import { getMemoryInstance } from "./core/memory.js";
import { getMemoryUtilsInstance } from "./core/memoryUtils.js";
import { getQuirksInstance } from "./core/quirks.js";
import { getRegistersInstance } from "./core/registers.js";
import { getROMInstance } from "./core/rom.js";
import { getSoundInstance } from "./core/sound.js";
import { getStackInstance } from "./core/stack.js";
import { getTimerInstance } from "./core/timer.js";
import { getUIInstance } from "./core/ui.js";
import { getUtilsInstance } from "./core/utils.js";
import { getInstanceProvider } from "./utils/depUtils.js";

/**
.@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@
.@..........@@.........................@@@................................:.@...........#@.=.-.........@@.......@@
.@....::...@@....:..::.............@@@@@@@@@@....-.*..:.....::.::::...:...@.@.:.:.:...:@@..:.=.+@+.*#@-:@..*==-.@@
.@........@@...:.:.::........-::-.@@@@@...@@@#...+.%.:......::....::::....=+-....::...-%.....-.:@@@@#.#:@..*.:-.@@
.@.......@@....-:::..........-:.-.@@........@@...*.@.::......:::::::.::........:......=@...+::..@...#@.-@..#:-=.@@
.@......@@....::.............-:.-.@@@#.@@@@@@@@@.%.@..::..........:..:::.@@@...:......#.*-#=--:.@@@@@:.:@..%:...@@
.@.....@@.....::....:::...::.:-.-.@@@@.@.@....@@.@.@..:...........:.:....@@@@....::..@#.:.=............*@..@....@@
.@....@@.....::::..::.::.::..:-.:..@.%.@.@@@@@@-.+.@..:...........:.::..@@.@@@=...:.-@.**.-:.:-:...:...@@..@.+..@@
.@...*@*...::::.....:::..:.:.--...@=*@.@.....+@@:..%..:...:.......:.::..@@..#@@@....%%....:..%-*#*.-==.@@..@.@..@@
.@...@@..:.::............:.:.:=...*#@@.@.@.....#%..*...:::.:......:.:...@@@@..%@@@@@-..:.....*+..+.:...@@..@-#..@@
.@..@@...:...::...............:.....@@.@*@.%@@@@*..=...:.:::......:..:..@@@@@@.%..@@...::::-:=.-*-.-::.%@..+....@@
.@..@@...::...:..........:::.::.....@@.@.@.@@@.....-.:::::.:......:::::.....@@@@@@@#.-....:..*.=...:...@@..*-...@@
.@..@@....-..:::.........:.::.....@@@@.@@@.@@@@@.....................:::.+.-.#@@.....+.=--.--:=-.::.::.@@..*:.:.@@
.@.@.@@=..-....:.........::...-@@@@@@......@@@@@@@.......:::::..:::::....=.@..........=:.+....:::..:.-.#@..+-.:.@@
.@.@:@%@..-..:.::......:-:..@@@@@@..-+:........+@@@@@........:.:..:.::...=@#:..=..:...+.%.+.::....:.:=.+@..+=:..@@
.@..@..@....::..:....::--...@@@........:.::::.....@@@@@...:::...:::::...%@@..=.*..:...=.@.#.--.-::-.:*..@..-:=..@@
.@.@@.@@@..:.:::.....::-...@@.+..@@..::.::.::..@@-...@@@.....::......:..@.@..=:+.::...................-*@...:*..@@
.@.:.@..@=.....::.:.::::..@@.....@*@...-=:...:.@.@@.+.@@@...::::...:::..%@@....:.......=@@@@@-@@@@@@@..@@.:.-*..@@
.@.@@+...@....:::...:.::..@@.....@.@@@....:..:.@.@:=..:@@..::.::...::...+........:..:..*#*@@@.@@@@@@@@.@@.-.:*..@@
.@....:@.+@....::...::::...@@@=*.@@..@..:.:..:.@.@...@@@..::.:::...::...@@+#@=:..:..:..#@@..@.@.....@@.@@..-.*..@@
.@+@#-.@@@@@:...::.::::-...+@@@....@@%.........@.@@@@@@.....:::....::...=%:..%...::......@@.*@.#..:.@@.%@..+.*..@@
.@.........@@@...:.....::.....@@-..@@@@.@@@@@+.@+.@.@.....::::.....::::...@::@.:...:=+*-.@@..#.@....@%.-@..=:*..@@
.@..@@@-.....@@:..::.:.:::-:..@@@@#...@.....@@.@.@..@...:....:.....::.....@..@.:::.-:....@@..*.*....@@.#@.:.-+..@@
.@.#:.#.....:..-..::..:..::.:..@@@@@@#@.+@@@.@.@@@@@@..::.:::::....::.:...@..@...:::=**+.@@@@@.@@@@@@@.@@...=-..@@
.@.....@@@@@@@@.....:.....:.-....@@..*.+@..@.@..@@.....:.:::::......:::...@:.@...........@...@......-@.@@...::..@@
.@@@@@@@@-.....#.#=..::..::.::..@@.:.@:@@@.%@@..@@.-..::.:..:..:.........:@=.@.:::.::....@=-.@@*....@@.@@..-=+..@@
.@........*@@@*.@:@...::..-:::..@@.....@.@@@....@@.+.....::::::...:::::..:@-.@...:......+%:@@@@@@@@@@..@#..+.@..@@
.@..............@.@@...:..-.....@@....+@@@@.....@@.:.:::.::::.:::::......:@..@..:.:::-:.=@@@...........@%..*.@..@@
.@..-=..........@#.@@...:.:....@@+%...@@..@@....@@............:...::::::.*+............................@@..-.+..@@
.@..-::::..=@@%.@%..@@.........@@.*..+@@..@@..:.@@.@@@@@@@@#...........:.@..+@@@@@.@@@@@..%@@@@@=.=@@@+*@..*.%..@@
.@.......:.:...+@....@-#@@@@@@.@@....@@=..@@....@@.-*#%%%%%@@%@@*=%@#-::.@+.@@@@@@.@@@@@.@@@=+@@..@@@@@@-..@.@..@@
.@..=+=::.:+@@#.@@@@@@%%@@@@@%.@@....@@.*.@@....@@..........-#%%@#.......+=.@@..@@.@@.@@.*.-@@*-.@@...:-...@.@..@@
.@....-.........%@@@@..........@@...@@@...@@@...@@...............--.=....@%.@@..@*.@@.@@.#@@...-+.=-...*#..@.@..@@
.@.=++=:----:-.+=......::..:-.@@@@@@@@.%@%.@@@@@@@.%@@@@##@@@@@@--.+*....@..@@@@@*.@@@@@.-.-@@@+..-#+*==*=.@=@..@@
.@.:--::------.:#@#.:..==+++=.@@@@@@@.......@@@@@+.@@*.@@@+....+-+*-..##.:#.@@@@...@@@@@........:@@-.==:.=:*#=..@@
.@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@@#@@

 */
// const global = getGlobalInstance();
// const input = ();
// const timer = createTimer();
// const memory = createMemory();
// const registers = createRegisters();

// const memoryUtils = createMemoryUtils({ memory });
// const display = createDisplay({ registers });
// const sound = createSound({ global, timer });
// const utils = createUtils();

// // TODO: Fix cyclic dependency
// const cpu = createCPU();
// const ui = createUI({});
// const stack = createStack();

// const rom = createROM();

const instanceProvider = getInstanceProvider();
const instanceFns = {
  cpu: getCPUInstance,
  display: getDisplayInstance,
  global: getGlobalInstance,
  input: getInputInstance,
  memory: getMemoryInstance,
  memoryUtils: getMemoryUtilsInstance,
  quirks: getQuirksInstance,
  registers: getRegistersInstance,
  rom: getROMInstance,
  sound: getSoundInstance,
  stack: getStackInstance,
  timer: getTimerInstance,
  ui: getUIInstance,
  utils: getUtilsInstance,
};

for (const [k, v] of Object.entries(instanceFns)) {
  instanceProvider.addInstance(k, v);
}

window.chip8 = Object.create(null);
registerDOMEvents(instanceProvider);
